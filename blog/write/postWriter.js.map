{"version":3,"file":"postWriter.js","sourceRoot":"","sources":["postWriter.ts"],"names":[],"mappings":"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","sourcesContent":["interface Person {\n    username : string,\n    uid: string,\n    photoUrl: string\n}\n\ninterface Comm{\n    author: Person,\n\n    time: Date,\n    content: string\n}\n\ninterface Post {\n    author: Person,\n    title: string,\n    time: Date,\n    content: string,\n    comments:Array<Comm>\n}\n\nfunction makeComment(c:Comm):string{\n    return `<li class=\"list-group-item pb-0\"><h5><img height=\"30px\" src=\"${c.author.photoUrl}\" class=\"rounded-circle mr-3\">${c.author.username}</h5>\n                    <div class=\"pl-5\">\n                        <p>${c.content}</p>\n                    </div>\n\n                </li>`;\n}\n\nfunction makeCommentList(comms:Array<Comm>){\n    let complete: string = ``;\n    for (var c of comms){\n        complete += makeComment(c);\n    }\n    return complete\n}\n\nfunction typeset(){\n    // @ts-ignore\n    renderMathInElement(document.querySelector(\"#postHolder\"),{delimiters: [\n            {left: \"$$\", right: \"$$\", display: true},\n            {left: \"$\", right: \"$\", display: false}\n        ]});\n}\n\n\nfunction printDate(d:Date){\n    const minSince:number = Math.ceil((Date.now()-d.getTime())/60000);\n    const hrSince:number  = Math.floor(minSince/60);\n    const daySince:number  = Math.floor(hrSince/24);\n    const weekSince:number  = Math.floor(daySince/7);\n    const monthSince:number  = Math.floor(weekSince/4);\n    //const yearSince:number  = Math.floor(monthSince/12);\n    if (minSince==0){\n        return \"just now\";\n    }\n    else if (minSince < 60){\n        return `${minSince} minute${minSince==1 ? '':'s'} ago`;\n    }\n    else if (hrSince < 24){\n        return `${hrSince} hour${hrSince==1 ? '':'s'} ago`;\n    }\n    else if (daySince < 7){\n        return `${daySince} day${daySince==1 ? '':'s'} ago`;\n    }\n    else if (weekSince < 4){\n        return `${weekSince} week${weekSince==1 ? '':'s'} ago`;\n    }\n    else {\n\n        const months = [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"June\", \"Jul\", \"Aug\", \"Sept\", \"Oct\", \"Nov\", \"Dec\"];\n        return `on ${months[d.getMonth()]} ${d.getDate()}, ${d.getFullYear()}`;\n        // on Jul 31, 1975\n    }\n}\n// @ts-ignore\nfunction makePost(p:Post): string {\n    return `<div class=\"card my-3 no-def\" >\n        <div class=\"card-body\">\n            <h3 class=\"card-title\"><img alt=\"${p.author.username}\" height=\"40px\" src=\"${p.author.photoUrl}\" class=\"rounded-circle mr-3 mb-1\">${p.title}</h3>\n            \n            <h6 class=\"card-subtitle mb-2 text-muted\">By ${p.author.username} ${\n        //@ts-ignore\n        printDate(p.time.toDate())}</h6>\n            <p class=\"card-text\">${p.content}</p>\n            ${p.comments.length==0 ? ``:`<details><summary><h5 class=\"card-title comment-title\">Comments </h5></summary>\n            <ul class=\"list-group\" >\n                ${makeCommentList(p.comments)}\n\n            </ul>\n            </details>`}\n        </div>\n    </div>`;\n}\n\n// @ts-ignore\nfunction showPost(p: Post, dest:string) :void {\n    const newPost = document.createElement(\"DIV\");\n\n    document.getElementById(dest).prepend(newPost);\n    newPost.outerHTML = makePost(p);\n}\n\nfunction sendPost(){\n    //get the details about the post\n    // @ts-ignore\n    const u :firebase.user = auth.currentUser;\n    const p:Post = {\n        author:{\n            username: u.displayName,\n            uid: u.uid,\n            photoUrl: u.photoURL\n        },\n        // @ts-ignore\n        title: document.getElementById(\"wpTitle\").value,\n        // @ts-ignore\n        content: document.getElementById(\"wpContent\").value,\n        comments: [],\n        time: new Date()\n    }\n\n    //get a reference to the database, and push the post.\n    // @ts-ignore\n\n    db.collection(\"blog\").doc(\"posts\").update({\n        // @ts-ignore\n        all: firebase.firestore.FieldValue.arrayUnion(p)\n    })\n        .then(function() {\n            console.log(\"Document successfully written!\");\n        })\n        .catch(function(error) {\n            console.error(\"Error writing document: \", error);\n        });\n    //@ts-ignore\n    document.getElementById(\"wpTitle\").value = \"\";\n    //@ts-ignore\n    document.getElementById(\"wpContent\").value = \"\";\n    return p;\n}\n\n\n// @ts-ignore\nlet posts;\n// @ts-ignore\ndb.collection(\"blog\").doc(\"posts\")\n    .onSnapshot(function(doc) {\n        //console.log(\"Current data: \", doc.data());\n        const d =doc.data();\n        posts = d.all;\n        document.getElementById(\"postHolder\").innerHTML = \"\";\n        for (var p of posts){\n            showPost(p, \"postHolder\");\n        }\n        typeset()\n    });\n// @ts-ignore\nfirebase.auth().onAuthStateChanged(function(user) {\n    if (user) {\n        if (user.photoURL != null) {\n            document.getElementById(\"wpPic\").src = user.photoURL;\n        }\n        else{\n            document.getElementById(\"wpPic\").src = \"/icons/greenPi.svg\";\n        }\n    }\n    else {}\n});"]}